<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>HTML Sudoku Board</title>
    
    <link href="css/bootstrap.min.css" type="text/css" rel="stylesheet" media="screen,projection">
    <link href="css/style.css" type="text/css" rel="stylesheet" media="screen,projection">
    
    <script type="text/javascript" src="js/sudoku.js"></script>
      

    </style>
  </head>
  <body>

    <div class="container">
      
      <h1>HTML Sudoku Board</h1>

      <table id="grid">

        <tr>
          <td><input onchange="setValMatrix(this.value,'0','0')" min="1" max="9" id="cell-11"  type="number"></td>
          <td><input onchange="setValMatrix(this.value,'0','1')" min="1" max="9" id="cell-12"  type="number"></td>
          <td><input onchange="setValMatrix(this.value,'0','2')" min="1" max="9" id="cell-13"  type="number"></td>
          
          <td><input onchange="setValMatrix(this.value,'0','3')" min="1" max="9" id="cell-14"  type="number"></td>
          <td><input onchange="setValMatrix(this.value,'0','4')" min="1" max="9" id="cell-15"  type="number"></td>
          <td><input onchange="setValMatrix(this.value,'0','5')" min="1" max="9" id="cell-16"  type="number"></td>
          
          <td><input onchange="setValMatrix(this.value,'0','6')" min="1" max="9" id="cell-17"  type="number"></td>
          <td><input onchange="setValMatrix(this.value,'0','7')" min="1" max="9" id="cell-18"  type="number"></td>
          <td><input onchange="setValMatrix(this.value,'0','8')" min="1" max="9" id="cell-19"  type="number"></td>
        </tr>

        <tr>
          <td><input onchange="setValMatrix(this.value,'1','0')" min="1" max="9" id="cell-21"  type="number"></td>
          <td><input onchange="setValMatrix(this.value,'1','1')" min="1" max="9" id="cell-22" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'1','2')" min="1" max="9" id="cell-23" type="number"></td>
        
          <td><input onchange="setValMatrix(this.value,'1','3')" min="1" max="9" id="cell-24" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'1','4')" min="1" max="9" id="cell-25" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'1','5')" min="1" max="9" id="cell-26" type="number"></td>
          
          <td><input onchange="setValMatrix(this.value,'1','6')" min="1" max="9" id="cell-27" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'1','7')" min="1" max="9" id="cell-28" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'1','8')" min="1" max="9" id="cell-29" type="number"></td>
        </tr>

        <tr>          
          <td><input onchange="setValMatrix(this.value,'2','0')" min="1" max="9" id="cell-31" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'2','1')" min="1" max="9" id="cell-32" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'2','2')" min="1" max="9" id="cell-33" type="number"></td>
          
          <td><input onchange="setValMatrix(this.value,'2','3')" min="1" max="9" id="cell-34" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'2','4')" min="1" max="9" id="cell-35" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'2','5')" min="1" max="9" id="cell-36" type="number"></td>
          
          <td><input onchange="setValMatrix(this.value,'2','6')" min="1" max="9" id="cell-37" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'2','7')" min="1" max="9" id="cell-38" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'2','8')" min="1" max="9" id="cell-39" type="number"></td>
        </tr>

        <tr>          
          <td><input onchange="setValMatrix(this.value,'3','0')" min="1" max="9" id="cell-41" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'3','1')" min="1" max="9" id="cell-42" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'3','2')" min="1" max="9" id="cell-43" type="number"></td>
          
          <td><input onchange="setValMatrix(this.value,'3','3')" min="1" max="9" id="cell-44" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'3','4')" min="1" max="9" id="cell-45" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'3','5')" min="1" max="9" id="cell-46" type="number"></td>
          
          <td><input onchange="setValMatrix(this.value,'3','6')" min="1" max="9" id="cell-47" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'3','7')" min="1" max="9" id="cell-48" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'3','8')" min="1" max="9" id="cell-49" type="number"></td>
        </tr>

        <tr>          
          <td><input onchange="setValMatrix(this.value,'4','0')" min="1" max="9" id="cell-51" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'4','1')" min="1" max="9" id="cell-52" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'4','2')" min="1" max="9" id="cell-53" type="number"></td>
          
          <td><input onchange="setValMatrix(this.value,'4','3')" min="1" max="9" id="cell-54" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'4','4')" min="1" max="9" id="cell-55" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'4','5')" min="1" max="9" id="cell-56" type="number"></td>
          
          <td><input onchange="setValMatrix(this.value,'4','6')" min="1" max="9" id="cell-57" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'4','7')" min="1" max="9" id="cell-58" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'4','8')" min="1" max="9" id="cell-59" type="number"></td>
        </tr>

        <tr>          
          <td><input onchange="setValMatrix(this.value,'5','0')" min="1" max="9" id="cell-61" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'5','1')" min="1" max="9" id="cell-62" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'5','2')" min="1" max="9" id="cell-63" type="number"></td>
          
          <td><input onchange="setValMatrix(this.value,'5','3')" min="1" max="9" id="cell-64" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'5','4')" min="1" max="9" id="cell-65" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'5','5')" min="1" max="9" id="cell-66" type="number"></td>
          
          <td><input onchange="setValMatrix(this.value,'5','6')" min="1" max="9" id="cell-67" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'5','7')" min="1" max="9" id="cell-68" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'5','8')" min="1" max="9" id="cell-69" type="number"></td>
        </tr>

        <tr>          
          <td><input onchange="setValMatrix(this.value,'6','0')" min="1" max="9" id="cell-71" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'6','1')" min="1" max="9" id="cell-72" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'6','2')" min="1" max="9" id="cell-73" type="number"></td>
        
          <td><input onchange="setValMatrix(this.value,'6','3')" min="1" max="9" id="cell-74" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'6','4')" min="1" max="9" id="cell-75" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'6','5')" min="1" max="9" id="cell-76" type="number"></td>
          
          <td><input onchange="setValMatrix(this.value,'6','6')" min="1" max="9" id="cell-77" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'6','7')" min="1" max="9" id="cell-78" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'6','8')" min="1" max="9" id="cell-79" type="number"></td>
        </tr>

        <tr>          
          <td><input onchange="setValMatrix(this.value,'7','0')" min="1" max="9" id="cell-81" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'7','1')" min="1" max="9" id="cell-82" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'7','2')" min="1" max="9" id="cell-83" type="number"></td>
          
          <td><input onchange="setValMatrix(this.value,'7','3')" min="1" max="9" id="cell-84" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'7','4')" min="1" max="9" id="cell-85" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'7','5')" min="1" max="9" id="cell-86" type="number"></td>
          
          <td><input onchange="setValMatrix(this.value,'7','6')" min="1" max="9" id="cell-87" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'7','7')" min="1" max="9" id="cell-88" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'7','8')" min="1" max="9" id="cell-89" type="number"></td>
        </tr>

        <tr>          
          <td><input onchange="setValMatrix(this.value,'8','0')" min="1" max="9" id="cell-91" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'8','1')" min="1" max="9" id="cell-92" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'8','2')" min="1" max="9" id="cell-93" type="number"></td>
          
          <td><input onchange="setValMatrix(this.value,'8','3')" min="1" max="9" id="cell-94" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'8','4')" min="1" max="9" id="cell-95" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'8','5')" min="1" max="9" id="cell-96" type="number"></td>
          
          <td><input onchange="setValMatrix(this.value,'8','6')" min="1" max="9" id="cell-97" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'8','7')" min="1" max="9" id="cell-98" type="number"></td>
          <td><input onchange="setValMatrix(this.value,'8','8')" min="1" max="9" id="cell-99" type="number"></td>
        </tr>

      </table>
      <form>
      <div>
        <div id="resultado">Sudoku File</div>
        <div style="display: inline;">
        <input type="file" id="fileInput" name="" style="width: 100%">
        <button type="button" id="Solucionar" class="btn btn-primary">Solucionar Metodo Infinito</button>
        <button type="button" id="Solucionar2" class="btn btn-primary">Solucionar Metodo Corto</button>
        </div>
        <pre id="fileDisplayArea"><pre>
      </div>
      
    </div>

  </body>
  <script>
  var matrix = [];
  var acabei = false;

  window.onload = function() {
    var p = 0;
    var q = 0;
    var solucoes = 0;
    var fileInput = document.getElementById('fileInput');
    var button = document.getElementById('Solucionar');
    var button2 = document.getElementById('Solucionar2');
    var fileDisplayArea = document.getElementById('fileDisplayArea');
    var res = document.getElementById('resultado');

    resetMatrix();

    fileInput.addEventListener('change', function(e) {
      var file = fileInput.files[0];
      var textType = /text.*/;

      resetMatrix();

      if (file.type.match(textType)) {
        var reader = new FileReader();

        reader.onload = function(e) {
          fileDisplayArea.innerText = reader.result;
          var numeros = (reader.result).split(/[\s\n]+/);
          for (var i = 0; i < numeros.length; i++) {
            if(numeros[i].trim() != ""){
              var l = numeros[i].substring(0,1);
              var c = numeros[i].substring(1,2);
              var n = numeros[i].substring(2,3);
              document.getElementById('cell-'+l+c).setAttribute('value',n);
              document.getElementById('cell-'+l+c).value = n;
              matrix[l-1][c-1][n] = true;
              matrix[l-1][c-1][0] = true;
            }
          }
        }

        reader.readAsText(file);    
      } else {
          fileDisplayArea.innerText = "File not supported!"
      }
    });

    button.addEventListener('click', function(e) {
      var continuar = function(){
        var Atest = A(matrix);
        var Btest = B(matrix);
        var Ctest = C(matrix);
        var Dtest = D(matrix);
        var Etest = E(matrix);

        if(Atest && Btest){
          if(Ctest && Dtest && Etest){
            console.log("Achei solução")
            alert("Solução achada"),
            acabei = true;
          }
          else{
            setTimeout(function() {aumentarUltimoNumeroMatrix();}, 1);
          }
        }
        else{
          setTimeout(function() {adicionrUltimoNumeroMatrix();}, 1);
        }
        setTimeout(function() {
            if(!acabei)
              continuar()
            else{
              console.log("Acabei");
            }

          },3);
      }


      for(var linha = 0; linha < 9; linha += 1) {
        for(var coluna = 0; coluna < 9; coluna += 1) {          
          if(matrix[linha][coluna][0] == true){
            document.getElementById('cell-'+(linha+1)+(coluna+1)).disabled = true;
          }
        }
      }

      var Atest = A(matrix);
      var Btest = B(matrix);
      var Ctest = C(matrix);
      var Dtest = D(matrix);
      var Etest = E(matrix);

      if(Ctest && Dtest && Etest){
        continuar();
      }
      else{
        fileDisplayArea.innerText = "Sudoku Errado"
      }
    });

    button2.addEventListener('click', function(e) {
      var continuar = function(){
        var Atest = A(matrix);
        var Btest = B(matrix);
        var Ctest = C(matrix);
        var Dtest = D(matrix);
        var Etest = E(matrix);

        if(Ctest && Dtest && Etest){
        	if(Atest && Btest){
	            console.log("Achei solução")
            	alert("Solução achada"),
            	acabei = true;
          	}
          	else{
            	setTimeout(function() {adicionrUltimoNumeroMatrix();}, 1);
          }
        }
	    else{
            setTimeout(function() {aumentarUltimoNumeroMatrix();}, 1);
        }
          setTimeout(function() {
            if(!acabei)
              continuar()
            else{
              console.log("Acabei");
              // console.log("O sudoku tem "+solucoes+" Soluções");
              // res.innerText = "O sudoku tem "+solucoes+" Soluções";
            }

          },3);
      }


      for(var linha = 0; linha < 9; linha += 1) {
        for(var coluna = 0; coluna < 9; coluna += 1) {          
          if(matrix[linha][coluna][0] == true){
            document.getElementById('cell-'+(linha+1)+(coluna+1)).disabled = true;
          }
        }
      }

      var Atest = A(matrix);
      var Btest = B(matrix);
      var Ctest = C(matrix);
      var Dtest = D(matrix);
      var Etest = E(matrix);

      if(Ctest && Dtest && Etest){
        continuar();
      }
      else{
        fileDisplayArea.innerText = "Sudoku Errado"
      }

      // if(Atest)
      //   console.log("(A) Pelo Menos 1 dig True")
      // else
      //   console.log("(A) Pelo Menos 1 dig False")
      // if(Btest)
      //   console.log("(B) No Max 1 dig True")
      // else
      //   console.log("(B) No Max 1 dig False")
      // if(Ctest)
      //   console.log("(C) Linhas True")
      // else
      //   console.log("(C) Linhas False")
      // if(Dtest)
      //   console.log("(D) Colunas True")
      // else
      //   console.log("(D) Colunas False")
      // if(Etest)
      //   console.log("(E) Subgrid True")
      // else
      //   console.log("(E) Subgrid False")      
    });

    var adicionrUltimoNumeroMatrix = function () {
      for(var linha = 0; linha < 9; linha += 1) {
        for(var coluna = 0; coluna < 9; coluna += 1) {          
          if(matrix[linha][coluna][0] != true){
            var a = false;
            for (var i = 1; i <= 9; i++) {
              a = a || matrix[linha][coluna][i];
            }
            if(!a){
              setTrueMatrix(linha,coluna,1);
              p = linha;
              q = coluna;
              return;
            }
          }
        }
      }
    }

    var aumentarUltimoNumeroMatrix = function () {
      var a = false;
      if(!matrix[p][q][0]){
      for (var i = 1; i <= 9; i++) {
          if(!a){
            a = matrix[p][q][i];
            matrix[p][q][i] = false;
          }
          else{
            setTrueMatrix(p,q,i)
            return;
          }
        }
        setFalseMatrix(p,q,9)
      }
      q--;
      if(q<0){
        p--;
        q = 8;
        if(p<0){
          acabei = true;
          return;
        }
      }
      aumentarUltimoNumeroMatrix();      
    }
  }

  var resetMatrix = function(){
    acabei = false;
    solucoes = 0;
    for(var linha = 0; linha < 9; linha += 1) {
      matrix[linha] = [];
      for(var coluna = 0; coluna < 9; coluna += 1) {
        matrix[linha][coluna] = [];
        for(var num = 0; num <= 9; num++) {
          matrix[linha][coluna][num] = false;
        }
        document.getElementById('cell-'+(linha+1)+(coluna+1)).disabled = false;
        document.getElementById('cell-'+(linha+1)+(coluna+1)).setAttribute('value',"");
        document.getElementById('cell-'+(linha+1)+(coluna+1)).value = "";
      }
    }
  }

  var setTrueMatrix = function(l,c,n){
      document.getElementById('cell-'+(l+1)+(c+1)).setAttribute('value',n);
      document.getElementById('cell-'+(l+1)+(c+1)).value = n;
      matrix[l][c][n] = true;
  }

  var setFalseMatrix = function(l,c,n){
    document.getElementById('cell-'+(l+1)+(c+1)).setAttribute('value',"");
    document.getElementById('cell-'+(l+1)+(c+1)).value = "";
    matrix[l][c][n] = false;
  }

  var setValMatrix = function(n,l,c){
    for(var num = 0; num <= 9; num++) {
      matrix[l][c][num] = false;
    }
    if(n != ""){
      if(n>9){
        n = 9;
      } else if(n<1){
        n = 1;
      }
      setTrueMatrix(parseInt(l),parseInt(c),n);
      matrix[l][c][0] = true;
    }
  }

  </script>
</html>